<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OrbitalShield</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Import map for Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
      "OrbitControls": "https://unpkg.com/three@0.150.1/examples/jsm/controls/OrbitControls.js",
      "CSS2DRenderer": "https://unpkg.com/three@0.150.1/examples/jsm/renderers/CSS2DRenderer.js"
    }
  }
  </script>

  <!-- External CSS -->
  <link rel="stylesheet" href="style.css" />
  
  <!-- Defense System Module -->
  <script src="defense-system.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; font-family: Arial, sans-serif;">
    <div style="text-align: center;">
      <h2 style="margin-bottom: 20px; color: #ffffff;">OrbitalShield</h2>
      <div id="loadingProgress" style="margin-bottom: 15px;">Initializing...</div>
      <div style="width: 300px; height: 6px; background: #333; border-radius: 3px; overflow: hidden;">
        <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #666666, #aaaaaa); transition: width 0.3s ease;"></div>
      </div>
      <div id="loadingDetails" style="margin-top: 15px; font-size: 14px; color: #aaa;">Loading textures...</div>
    </div>
  </div>

  <!-- Scroll to Enter Page -->
  <div id="enterScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('starmap.jpg') center center / cover no-repeat, linear-gradient(135deg, #000000 0%, #000 100%); color: #fff; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 999; font-family: Arial, sans-serif; overflow: hidden;">
    <!-- Dark overlay for better text readability -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 1;"></div>
    
    <div style="text-align: center; max-width: 600px; padding: 40px; position: relative; z-index: 2;">
      <h1 style="font-size: 3.5em; margin-bottom: 20px; background: linear-gradient(45deg, #ffffff, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">OrbitalShield</h1>
      <p style="font-size: 1.3em; margin-bottom: 30px; color: #cccccc; line-height: 1.6; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">Real time Near-Earth Asteroid tracking and impact assessment using NASA's NeoWS API</p>
      <div style="margin: 40px 0;">
        <div style="display: inline-block; padding: 15px 25px; border: 2px solid #ffffff; border-radius: 50px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);">
          <span style="font-size: 1.1em; color: #ffffff; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">Scroll down to explore</span>
        </div>
      </div>
      <div style="margin-top: 50px; animation: bounce 2s infinite;">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.8));">
          <polyline points="6,9 12,15 18,9"></polyline>
        </svg>
      </div>
    </div>
    <style>
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
      }
    </style>
  </div>

  <!-- Three.js canvas - initially hidden during loading/scroll phases -->
  <div id="canvas" style="opacity: 0; transition: opacity 0.8s ease;"></div>
  
  <!-- UI Overlay -->
  <div id="ui-overlay" style="opacity: 0; transition: opacity 0.8s ease;">
    <div id="header" style="position: relative;">
      <h1>OrbitalShield</h1>
      <div style="position: absolute; top: 10px; right: 20px;">
  <span id="searchIcon" class="search-icon"></span>
  <input id="asteroidSearch" type="text" placeholder="Search asteroid..." style="padding: 4px 10px; border-radius: 4px; border: 1px solid #888; min-width: 180px; display:none;" autocomplete="off" />
  <div id="searchResults" style="position: absolute; right: 0; background: #222; color: #fff; border-radius: 0 0 6px 6px; box-shadow: 0 2px 8px #0008; z-index: 100; display: none; max-height: 220px; overflow-y: auto;"></div>
      </div>
    </div>

    <div id="controls">
      <div class="controls-header">
        <div class="legend">
          <span class="box" style="background:#ff4444"></span> Hazardous &nbsp;&nbsp;
          <span class="box" style="background:#44ff88"></span> Safe
        </div>
        <button id="toggleControls" title="Minimize/Expand Controls">"<"</button>
      </div>

      <div id="controlsContent">


        <!-- Asteroid Count Control -->
        <div id="countControls" style="margin-top: 12px;">
          <label for="asteroidCount">No. of Asteroids to Plot</label><br>
          <input type="number" id="asteroidCount" min="1" max="200" step="1" value="20" style="width: 80px;" />
          <button id="refreshBtn" style="margin-left: 8px; padding: 4px 8px;">🔄 Refresh</button>
        </div>

        <!-- Impact Location Simulation -->
        <div id="impactLocationControls" style="margin-top: 12px;">
          <div class="dropdown-header" onclick="toggleDropdown('impactLocationContent')" style="cursor: pointer; background: rgba(255, 204, 0, 0.1); border: 1px solid #ffcc00; border-radius: 6px; padding: 8px; display: flex; align-items: center; justify-content: space-between;">
            <label style="color: #ffcc00; font-weight: bold; margin: 0;">🎯 Impact Location Simulator</label>
            <span id="impactLocationArrow" style="color: #ffcc00; font-weight: bold; transform: rotate(-90deg); transition: transform 0.3s;">▼</span>
          </div>
          <div id="impactLocationContent" style="display: none; margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px; border: 1px solid #333;">
            <!-- City Selection Dropdown -->
            <div style="margin-bottom: 8px;">
              <label style="color: #ccc; font-size: 12px; margin-bottom: 4px; display: block;">🌍 Select Target City:</label>
              <select id="citySelect" style="width: 100%; padding: 6px; background: #222; border: 1px solid #555; border-radius: 4px; color: #fff; font-size: 11px;">
                <option value="" style="background: #222; color: #ccc;">-- Choose a city --</option>
                
                <!-- NORTH AMERICA -->
                <optgroup label="� NORTH AMERICA">
                  <!-- United States -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇺🇸 United States</option>
                  <option value="40.7128,-74.0060">├── 🏙️ New York City (8.3M)</option>
                  <option value="34.0522,-118.2437">├── 🌴 Los Angeles (13.2M)</option>
                  <option value="41.8781,-87.6298">├── 🏢 Chicago (9.5M)</option>
                  <option value="29.7604,-95.3698">├── 🚀 Houston (7.1M)</option>
                  <option value="25.7617,-80.1918">├── 🏖️ Miami (6.2M)</option>
                  <option value="32.7767,-96.7970">├── 🤠 Dallas (7.6M)</option>
                  <option value="39.9526,-75.1652">├── 🔔 Philadelphia (6.1M)</option>
                  <option value="38.9072,-77.0369">└── 🏛️ Washington D.C. (6.3M)</option>
                  
                  <!-- Canada -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇨🇦 Canada</option>
                  <option value="43.6532,-79.3832">├── 🍁 Toronto (6.2M)</option>
                  <option value="49.2827,-123.1207">└── ⛰️ Vancouver (2.6M)</option>
                  
                  <!-- Mexico -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇲🇽 Mexico</option>
                  <option value="19.4326,-99.1332">└── 🌮 Mexico City (21.8M)</option>
                </optgroup>

                <!-- EUROPE -->
                <optgroup label="� EUROPE">
                  <!-- United Kingdom -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇬🇧 United Kingdom</option>
                  <option value="51.5074,-0.1278">└── 🏰 London (9.5M)</option>
                  
                  <!-- France -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇫🇷 France</option>
                  <option value="48.8566,2.3522">└── 🗼 Paris (11.0M)</option>
                  
                  <!-- Germany -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇩🇪 Germany</option>
                  <option value="52.5200,13.4050">├── 🧱 Berlin (3.7M)</option>
                  <option value="53.5511,9.9937">├── ⚓ Hamburg (1.9M)</option>
                  <option value="48.1351,11.5820">├── 🍺 Munich (2.6M)</option>
                  <option value="50.1109,8.6821">└── 🏢 Frankfurt (2.3M)</option>
                  
                  <!-- Spain -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇪🇸 Spain</option>
                  <option value="40.4168,-3.7038">├── 💃 Madrid (6.7M)</option>
                  <option value="41.3851,2.1734">└── 🏖️ Barcelona (5.6M)</option>
                  
                  <!-- Italy -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇮🇹 Italy</option>
                  <option value="41.9028,12.4964">└── 🏛️ Rome (4.3M)</option>
                  
                  <!-- Russia -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇷🇺 Russia</option>
                  <option value="55.7558,37.6173">├── 🏛️ Moscow (12.5M)</option>
                  <option value="59.9311,30.3609">└── ❄️ St. Petersburg (5.4M)</option>
                  
                  <!-- Turkey -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇹🇷 Turkey</option>
                  <option value="41.0082,28.9784">└── 🕌 Istanbul (15.5M)</option>
                  
                  <!-- Nordic Countries -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🌨️ Nordic Countries</option>
                  <option value="55.6761,12.5683">├── 🧜‍♀️ Copenhagen, Denmark (2.1M)</option>
                  <option value="59.3293,18.0686">├── 🏰 Stockholm, Sweden (2.4M)</option>
                  <option value="60.1695,24.9354">├── ❄️ Helsinki, Finland (1.5M)</option>
                  <option value="59.9139,10.7522">└── 🏔️ Oslo, Norway (1.7M)</option>
                  
                  <!-- Other Europe -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇪🇺 Other Europe</option>
                  <option value="50.0755,14.4378">├── 🏰 Prague, Czech Republic (1.3M)</option>
                  <option value="47.4979,19.0402">├── 🏰 Budapest, Hungary (1.8M)</option>
                  <option value="53.3498,-6.2603">├── ☘️ Dublin, Ireland (1.4M)</option>
                  <option value="38.7223,-9.1393">├── 🏰 Lisbon, Portugal (2.9M)</option>
                  <option value="46.2044,6.1432">├── �️ Geneva, Switzerland (0.6M)</option>
                  <option value="47.3769,8.5417">├── 💰 Zurich, Switzerland (1.4M)</option>
                  <option value="48.2082,16.3738">├── 🎭 Vienna, Austria (1.9M)</option>
                  <option value="50.8503,4.3517">├── 🍫 Brussels, Belgium (1.2M)</option>
                  <option value="52.3676,4.9041">└── 🌷 Amsterdam, Netherlands (2.4M)</option>
                </optgroup>

                <!-- ASIA -->
                <optgroup label="🌏 ASIA">
                  <!-- China -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇨🇳 China</option>
                  <option value="39.9042,116.4074">├── 🏮 Beijing (21.5M)</option>
                  <option value="31.2304,121.4737">└── 🏙️ Shanghai (24.8M)</option>
                  
                  <!-- Japan -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇯🇵 Japan</option>
                  <option value="35.6762,139.6503">├── 🏯 Tokyo (38.0M)</option>
                  <option value="35.6804,139.7690">└── 🌸 Osaka (18.9M)</option>
                  
                  <!-- India -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇮🇳 India</option>
                  <option value="28.6139,77.2090">├── 🕌 Delhi (33.0M)</option>
                  <option value="19.0760,72.8777">├── 🏙️ Mumbai (21.0M)</option>
                  <option value="12.9716,77.5946">└── 💻 Bangalore (13.2M)</option>
                  
                  <!-- South Korea -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇰🇷 South Korea</option>
                  <option value="37.5665,126.9780">└── 🏙️ Seoul (25.5M)</option>
                  <option value="35.6804,139.7690">🌸 Osaka, Japan (18.9M)</option>
                  <option value="1.3521,103.8198">�️ Singapore (5.9M)</option>
                  <option value="3.1390,101.6869">🏢 Kuala Lumpur, Malaysia (8.6M)</option>
                  <option value="13.7563,100.5018">🏯 Bangkok, Thailand (10.5M)</option>
                  <option value="10.8231,106.6297">🏙️ Ho Chi Minh City, Vietnam (9.3M)</option>
                  <option value="14.5995,120.9842">🏝️ Manila, Philippines (25.7M)</option>
                                    <option value="-6.2088,106.8456">└── 🏙️ Jakarta, Indonesia (35.0M)</option>
                  
                  <!-- Middle East -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🏜️ Middle East</option>
                  <option value="25.2048,55.2708">├── 🏗️ Dubai, UAE (3.5M)</option>
                  <option value="24.4539,54.3773">├── 🕌 Abu Dhabi, UAE (1.5M)</option>
                  <option value="35.6892,51.3890">├── 🏛️ Tehran, Iran (9.5M)</option>
                  <option value="24.7136,46.6753">├── 🏺 Riyadh, Saudi Arabia (7.7M)</option>
                  <option value="33.3152,44.3661">├── 🏛️ Baghdad, Iraq (7.5M)</option>
                  <option value="29.3117,47.4818">├── 🛢️ Kuwait City, Kuwait (4.1M)</option>
                  <option value="26.2285,50.5860">├── 💰 Manama, Bahrain (0.7M)</option>
                  <option value="25.3548,51.1839">├── ⚽ Doha, Qatar (2.4M)</option>
                  <option value="23.4241,53.8478">├── 🏛️ Muscat, Oman (1.6M)</option>
                  <option value="33.8869,35.5131">├── 🌲 Beirut, Lebanon (2.4M)</option>
                  <option value="33.5138,36.2765">├── 🏛️ Damascus, Syria (2.1M)</option>
                  <option value="31.7683,35.2137">├── 🕊️ Jerusalem, Israel/Palestine (1.0M)</option>
                  <option value="32.0853,34.7818">├── 🏖️ Tel Aviv, Israel (4.3M)</option>
                  <option value="31.9686,35.9023">└── 🏛️ Amman, Jordan (4.0M)</option>
                </optgroup>

                <!-- AFRICA -->
                <optgroup label="🌍 AFRICA">
                  <!-- Egypt -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇪🇬 Egypt</option>
                  <option value="30.0444,31.2357">├── 🏺 Cairo (21.3M)</option>
                  <option value="30.0626,31.2497">├── 🏺 Giza (9.2M)</option>
                  <option value="31.2001,29.9187">└── 🏛️ Alexandria (5.2M)</option>
                  
                  <!-- Nigeria -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇳🇬 Nigeria</option>
                  <option value="6.5244,3.3792">├── 🏙️ Lagos (15.3M)</option>
                  <option value="6.5244,3.3792">├── 🏙️ Abuja (3.3M)</option>
                  <option value="12.9716,77.5946">└── 💻 Kano (4.1M)</option>
                  
                  <!-- South Africa -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇿🇦 South Africa</option>
                  <option value="-26.2041,28.0473">├── 💎 Johannesburg (10.0M)</option>
                  <option value="-33.9249,18.4241">├── 🏔️ Cape Town (4.6M)</option>
                  <option value="-29.8587,31.0218">├── 🏖️ Durban (3.7M)</option>
                  <option value="-25.7479,28.2293">└── 🏛️ Pretoria (2.9M)</option>
                  
                  <!-- Other Africa -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🌍 Other Africa</option>
                  <option value="-1.2921,36.8219">├── 🦁 Nairobi, Kenya (4.4M)</option>
                  <option value="9.0579,38.7499">├── 🏛️ Addis Ababa, Ethiopia (5.0M)</option>
                  <option value="-6.7924,39.2083">├── 🌊 Dar es Salaam, Tanzania (6.7M)</option>
                  <option value="33.5731,-7.5898">├── 🏛️ Casablanca, Morocco (3.8M)</option>
                  <option value="15.5007,32.5599">├── 🏺 Khartoum, Sudan (6.1M)</option>
                  <option value="5.6037,-0.1870">├── 🌍 Accra, Ghana (4.3M)</option>
                  <option value="0.3476,32.5825">├── 🦍 Kampala, Uganda (3.3M)</option>
                  <option value="-1.9706,30.1044">├── 🦍 Kigali, Rwanda (1.3M)</option>
                  <option value="36.8065,10.1815">├── 🏛️ Tunis, Tunisia (2.3M)</option>
                  <option value="36.7538,3.0588">├── 🏛️ Algiers, Algeria (7.8M)</option>
                  <option value="-15.3875,28.3228">├── 💎 Lusaka, Zambia (3.1M)</option>
                  <option value="-17.8292,31.0522">└── 🏛️ Harare, Zimbabwe (2.1M)</option>
                </optgroup>

                <!-- SOUTH AMERICA -->
                <optgroup label="� SOUTH AMERICA">
                  <option value="30.0444,31.2357">🏺 Cairo, Egypt (21.3M)</option>
                  <option value="24.7136,46.6753">�️ Riyadh, Saudi Arabia (7.7M)</option>
                  <option value="33.3152,44.3661">🏛️ Baghdad, Iraq (7.5M)</option>
                  <option value="35.6892,51.3890">🏛️ Tehran, Iran (9.5M)</option>
                  <option value="-1.2921,36.8219">🦁 Nairobi, Kenya (4.4M)</option>
                  <option value="6.5244,3.3792">🏙️ Lagos, Nigeria (15.3M)</option>
                  <option value="-26.2041,28.0473">💎 Johannesburg, South Africa (10.0M)</option>
                  <option value="-33.9249,18.4241">🏔️ Cape Town, South Africa (4.6M)</option>
                  <option value="9.0579,38.7499">🏛️ Addis Ababa, Ethiopia (5.0M)</option>
                  <option value="-6.7924,39.2083">�️ Dar es Salaam, Tanzania (6.7M)</option>
                  <option value="33.5731,-7.5898">🏛️ Casablanca, Morocco (3.8M)</option>
                </optgroup>

                <!-- South America -->
                <optgroup label="🌎 South America">
                  <!-- Brazil -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇧🇷 Brazil</option>
                  <option value="-23.5505,-46.6333">├── 🏙️ São Paulo (22.4M)</option>
                  <option value="-22.9068,-43.1729">├── 🏖️ Rio de Janeiro (13.3M)</option>
                  <option value="-19.9167,-43.9345">└── 💎 Belo Horizonte (6.1M)</option>
                  
                  <!-- Argentina -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇦🇷 Argentina</option>
                  <option value="-34.6118,-58.3960">└── 💃 Buenos Aires (15.2M)</option>
                  
                  <!-- Colombia -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇨🇴 Colombia</option>
                  <option value="4.7110,-74.0721">├── 🏛️ Bogotá (11.0M)</option>
                  <option value="6.2442,-75.5812">└── 🌺 Medellín (4.0M)</option>
                  
                  <!-- Other South America -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🌎 Other South America</option>
                  <option value="-12.0464,-77.0428">├── 🏛️ Lima, Peru (10.9M)</option>
                  <option value="-33.4489,-70.6693">├── ⛰️ Santiago, Chile (7.2M)</option>
                  <option value="10.4806,-66.9036">├── 🏛️ Caracas, Venezuela (2.9M)</option>
                  <option value="-0.1807,-78.4678">├── 🌋 Quito, Ecuador (2.8M)</option>
                  <option value="-25.2637,-57.5759">├── 🌿 Asunción, Paraguay (3.2M)</option>
                  <option value="-34.9011,-56.1645">├── 🏖️ Montevideo, Uruguay (1.7M)</option>
                  <option value="-16.2902,-63.5887">├── 🏔️ Santa Cruz, Bolivia (1.4M)</option>
                  <option value="-17.7834,-63.1821">└── 🏛️ La Paz, Bolivia (2.3M)</option>
                </optgroup>

                <!-- OCEANIA -->
                <optgroup label="🏝️ OCEANIA">
                  <!-- Australia -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇦🇺 Australia</option>
                  <option value="-33.8688,151.2093">├── 🏖️ Sydney (5.3M)</option>
                  <option value="-37.8136,144.9631">├── ☕ Melbourne (5.1M)</option>
                  <option value="-27.4698,153.0251">├── ☀️ Brisbane (2.6M)</option>
                  <option value="-31.9505,115.8605">└── 🌊 Perth (2.1M)</option>
                  
                  <!-- New Zealand -->
                  <option value="" disabled style="background: #333; color: #ffcc00; font-weight: bold;">🇳🇿 New Zealand</option>
                  <option value="-36.8485,174.7633">├── 🐑 Auckland (1.7M)</option>
                  <option value="-41.2865,174.7762">├── 🌿 Wellington (0.4M)</option>
                  <option value="-43.5321,172.6362">└── 🏔️ Christchurch (0.4M)</option>
                </optgroup>
              </select>
            </div>
            
            <!-- Manual Coordinates (Optional) -->
            <div style="margin-bottom: 8px;">
              <label style="color: #888; font-size: 10px; margin-bottom: 4px; display: block;">Or enter custom coordinates:</label>
              <div style="display: flex; gap: 8px;">
                <input type="number" id="impactLat" placeholder="Latitude" step="0.1" style="width: 80px; padding: 4px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 3px; color: #aaa; font-size: 10px;" />
                <input type="number" id="impactLng" placeholder="Longitude" step="0.1" style="width: 80px; padding: 4px; background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 3px; color: #aaa; font-size: 10px;" />
                <button id="simulateImpact" style="padding: 4px 8px; background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444; border-radius: 3px; font-size: 10px;">Simulate</button>
              </div>
            </div>
            
            <button id="showImpactMap" style="font-size: 11px; padding: 6px 12px; background: rgba(255, 204, 0, 0.2); border: 1px solid #ffcc00; color: #ffcc00; border-radius: 3px; width: 100%;">🗺️ View Impact Map</button>
          </div>
        </div>

        <!-- Asteroid Visibility Control -->
        <div id="sizeControls" style="margin-top: 12px; flex-direction: column; align-items: stretch;">
          <label for="sizeRatio">Asteroid Visibility</label> 
          <div class="slider-row">
            <input type="range" id="sizeRatio" min="1" max="25" step="1" value="1" />
            <span id="sizeRatioValue">1x</span>
          </div>
        </div>

        <!-- Enhanced Deflection Strategy Panel -->
        <div id="simulationControls">
          <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; border: 1px solid #444;">
            <div class="dropdown-header" onclick="toggleDropdown('defenseContent')" style="cursor: pointer; background: rgba(255, 204, 0, 0.1); border: 1px solid #ffcc00; border-radius: 6px; padding: 8px; display: flex; align-items: center; justify-content: space-between; margin: -12px -12px 12px -12px;">
              <h3 style="margin: 0; color: #ffcc00; font-size: 14px;">🛡️ Planetary Defense Mission</h3>
              <span id="defenseArrow" style="color: #ffcc00; font-weight: bold; transform: rotate(-90deg); transition: transform 0.3s;">▼</span>
            </div>
            
            <div id="defenseContent" style="display: none;">
              <!-- Auto Optimize Toggle -->
              <div style="margin: 6px 0 12px 0; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                <label style="display:flex; align-items:center; gap:8px; color:#ccc;">
                  <input type="checkbox" id="autoOptimize" checked style="margin-right: 4px;" />
                  Auto-Optimize (recommended)
                </label>
                <span style="font-size:10px; color:#888;">Toggle off to manually adjust parameters</span>
              </div>
              
              <!-- Mission Method Selection -->
              <div style="margin-bottom: 12px;">
                <label for="mitigationMethod" style="color: #ccc; font-weight: bold;">Deflection Method:</label>
                <select id="mitigationMethod" style="width: 100%; padding: 6px; margin-top: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 4px; color: #fff;">
                  <option value="kinetic">🎯 Kinetic Impactor (DART-style)</option>
                  <option value="gravity">🌌 Gravity Tractor</option>
                  <option value="nuclear">💥 Nuclear Deflection</option>
                  <option value="laser">⚡ Laser Ablation</option>
                  <option value="ion">🔋 Ion Beam Shepherd</option>
                  <option value="mass_driver">🚀 Mass Driver</option>
                </select>
              </div>

              <!-- Mission Timeline -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                <div>
                  <label for="yearsOut" style="color: #ccc; font-size: 12px;">Years to Impact:</label>
                  <input type="number" id="yearsOut" min="0.5" max="50" step="0.5" value="5" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
                </div>
                <div>
                  <label for="missionDuration" style="color: #ccc; font-size: 12px;">Mission Duration (years):</label>
                  <input type="number" id="missionDuration" min="0.1" max="10" step="0.1" value="1.0" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
                </div>
              </div>

              <!-- Delta-V Control -->
              <div style="margin-bottom: 12px;">
                <label for="deltaV" style="color: #ccc; font-weight: bold;">ΔV Applied:</label>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                  <input type="range" id="deltaV" min="0" max="500" step="0.1" value="0" style="flex: 1;" />
                  <span id="deltaVValue" style="color: #ffcc00; font-weight: bold; min-width: 80px;">0.0 mm/s</span>
                </div>
                <div style="font-size: 11px; color: #888; margin-top: 2px;">
                  Typical range: 0.1-100 mm/s (depends on method and timing)
                </div>
              </div>

              <!-- Spacecraft Mass Parameters -->
              <div style="margin-bottom: 12px;">
                <div>
                  <label for="spacecraftMass" style="color: #ccc; font-size: 12px;">Spacecraft Mass (kg):</label>
                  <input type="number" id="spacecraftMass" min="500" max="50000" step="50" value="" placeholder="Auto-Optimized" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" title="Leave empty for method-optimal mass" />
                </div>
              </div>
              
              <div style="font-size: 10px; color: #888; margin-bottom: 12px; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 3px;">
                💡 Auto-optimization adjusts parameters based on asteroid characteristics<br>
                Method defaults: Kinetic(850kg), Gravity(2000kg), Nuclear(5000kg), Others(1400-4500kg)
              </div>

              <!-- Mission Results Display -->
              <div id="deflectionResults" style="background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; border-left: 4px solid #ffcc00; margin-bottom: 8px;">
                <div style="color: #ffcc00; font-weight: bold; margin-bottom: 8px; font-size: 13px;">📊 Mission Analysis</div>
                <div id="mitigationResult" style="color: #44ff88; font-weight: bold; margin-bottom: 6px; font-size: 12px;">
                  Miss Distance: Select parameters above
                </div>
                <div id="mitigationEfficiency" style="font-size: 11px; color: #aaa; margin-bottom: 6px;">
                  Method details will appear here
                </div>
                <div id="missionFeasibility" style="font-size: 11px; color: #ccc; margin-bottom: 6px;">
                  Mission feasibility: Not calculated
                </div>
              </div>

              <!-- Advanced Physics Display -->
              <div id="physicsDetails" style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; border: 1px solid #333; margin-bottom: 8px;">
                <div style="font-size: 11px; color: #aaa; margin-bottom: 6px;">� Physics Analysis</div>
                <div id="orbitalMechanics" style="font-size: 10px; color: #bbb; line-height: 1.4;">
                  • Orbital velocity change: 0 m/s<br>
                  • Deflection angle: 0.000°<br>
                  • Energy efficiency: 0%<br>
                  • Success probability: 0%
                </div>
              </div>
            </div>
          </div>
          
          <!-- Enhanced Information Panel -->
          <div id="infoPanel" style="margin-top: 12px;">
            <div style="margin-bottom: 8px;">
              <button id="educationalMode" style="padding: 4px 8px; font-size: 12px;">📚 Educational Mode</button>
              <button id="gamificationMode" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">🎮 Defend Earth</button>
              <button id="scenarioMode" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">🎭 Scenarios</button>
            </div>
            Select an asteroid (click name) to populate report. Open browser console to see fetched data.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- External JS -->
  <script type="module" src="impact-map.js"></script>
  <script type="module" src="scenarios.js"></script>
  <script type="module" src="main.js"></script>

  <!-- Asteroid search bar logic is now handled in main.js after asteroidCache is defined. -->
</body>
</html>
