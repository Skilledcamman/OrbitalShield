<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OrbitalShield</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Import map for Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
      "OrbitControls": "https://unpkg.com/three@0.150.1/examples/jsm/controls/OrbitControls.js",
      "CSS2DRenderer": "https://unpkg.com/three@0.150.1/examples/jsm/renderers/CSS2DRenderer.js"
    }
  }
  </script>

  <!-- External CSS -->
  <link rel="stylesheet" href="style.css" />
  
  <!-- Defense System Module -->
  <script src="defense-system.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; font-family: Arial, sans-serif;">
    <div style="text-align: center;">
      <h2 style="margin-bottom: 20px; color: #ffffff;">OrbitalShield</h2>
      <div id="loadingProgress" style="margin-bottom: 15px;">Initializing...</div>
      <div style="width: 300px; height: 6px; background: #333; border-radius: 3px; overflow: hidden;">
        <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #666666, #aaaaaa); transition: width 0.3s ease;"></div>
      </div>
      <div id="loadingDetails" style="margin-top: 15px; font-size: 14px; color: #aaa;">Loading textures...</div>
    </div>
  </div>

  <!-- Scroll to Enter Page -->
  <div id="enterScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('starmap.jpg') center center / cover no-repeat, linear-gradient(135deg, #000000 0%, #000 100%); color: #fff; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 999; font-family: Arial, sans-serif; overflow: hidden;">
    <!-- Dark overlay for better text readability -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 1;"></div>
    
    <div style="text-align: center; max-width: 600px; padding: 40px; position: relative; z-index: 2;">
      <h1 style="font-size: 3.5em; margin-bottom: 20px; background: linear-gradient(45deg, #ffffff, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">OrbitalShield</h1>
      <p style="font-size: 1.3em; margin-bottom: 30px; color: #cccccc; line-height: 1.6; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">Real time Near-Earth Asteroid tracking and impact assessment using NASA's NeoWS API</p>
      <div style="margin: 40px 0;">
        <div style="display: inline-block; padding: 15px 25px; border: 2px solid #ffffff; border-radius: 50px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);">
          <span style="font-size: 1.1em; color: #ffffff; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">Scroll down to explore</span>
        </div>
      </div>
      <div style="margin-top: 50px; animation: bounce 2s infinite;">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.8));">
          <polyline points="6,9 12,15 18,9"></polyline>
        </svg>
      </div>
    </div>
    <style>
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
      }
    </style>
  </div>

  <!-- Three.js canvas - initially hidden during loading/scroll phases -->
  <div id="canvas" style="opacity: 0; transition: opacity 0.8s ease;"></div>
  
  <!-- UI Overlay -->
  <div id="ui-overlay" style="opacity: 0; transition: opacity 0.8s ease;">
    <div id="header" style="position: relative;">
      <h1>OrbitalShield</h1>
      <div style="position: absolute; top: 10px; right: 20px;">
  <span id="searchIcon" class="search-icon"></span>
  <input id="asteroidSearch" type="text" placeholder="Search asteroid..." style="padding: 4px 10px; border-radius: 4px; border: 1px solid #888; min-width: 180px; display:none;" autocomplete="off" />
  <div id="searchResults" style="position: absolute; right: 0; background: #222; color: #fff; border-radius: 0 0 6px 6px; box-shadow: 0 2px 8px #0008; z-index: 100; display: none; max-height: 220px; overflow-y: auto;"></div>
      </div>
    </div>

    <div id="controls">
      <div class="controls-header">
        <div class="legend">
          <span class="box" style="background:#ff4444"></span> Hazardous &nbsp;&nbsp;
          <span class="box" style="background:#44ff88"></span> Safe
        </div>
        <button id="toggleControls" title="Minimize/Expand Controls">"<"</button>
      </div>

      <div id="controlsContent">
        <!-- Real-time Updates Control -->
        <div id="realTimeControls" style="margin-top: 12px;">
          <label>
            <input type="checkbox" id="realTimeToggle" style="margin-right: 8px;" />
            Real-time Updates (5min)
          </label>
        </div>

        <!-- Asteroid Count Control -->
        <div id="countControls" style="margin-top: 12px;">
          <label for="asteroidCount">No. of Asteroids to Plot</label><br>
          <input type="number" id="asteroidCount" min="1" max="200" step="1" value="20" style="width: 80px;" />
          <button id="refreshBtn" style="margin-left: 8px; padding: 4px 8px;">ğŸ”„ Refresh</button>
        </div>

        <!-- Impact Location Simulation -->
        <div id="impactLocationControls" style="margin-top: 12px;">
          <div class="dropdown-header" onclick="toggleDropdown('impactLocationContent')" style="cursor: pointer; background: rgba(255, 204, 0, 0.1); border: 1px solid #ffcc00; border-radius: 6px; padding: 8px; display: flex; align-items: center; justify-content: space-between;">
            <label style="color: #ffcc00; font-weight: bold; margin: 0;">ğŸ¯ Impact Location Simulator</label>
            <span id="impactLocationArrow" style="color: #ffcc00; font-weight: bold; transform: rotate(-90deg); transition: transform 0.3s;">â–¼</span>
          </div>
          <div id="impactLocationContent" style="display: none; margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 4px; border: 1px solid #333;">
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
              <input type="number" id="impactLat" placeholder="Latitude" step="0.1" style="width: 80px; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
              <input type="number" id="impactLng" placeholder="Longitude" step="0.1" style="width: 80px; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
              <button id="simulateImpact" style="padding: 4px 8px; background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444; border-radius: 3px;">Simulate</button>
            </div>
            
            <!-- Popular Places -->
            <div style="margin-bottom: 8px;">
              <label style="color: #ccc; font-size: 11px; margin-bottom: 4px; display: block;">Popular Impact Locations:</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 3px;">
                <button class="location-preset" data-lat="40.7128" data-lng="-74.0060" style="font-size: 10px; padding: 3px 5px; background: rgba(255, 99, 71, 0.2); border: 1px solid #ff6347; color: #ff6347; border-radius: 3px; cursor: pointer;">ğŸ™ï¸ NYC</button>
                <button class="location-preset" data-lat="34.0522" data-lng="-118.2437" style="font-size: 10px; padding: 3px 5px; background: rgba(255, 215, 0, 0.2); border: 1px solid #ffd700; color: #ffd700; border-radius: 3px; cursor: pointer;">ğŸŒ´ LA</button>
                <button class="location-preset" data-lat="35.6762" data-lng="139.6503" style="font-size: 10px; padding: 3px 5px; background: rgba(255, 20, 147, 0.2); border: 1px solid #ff1493; color: #ff1493; border-radius: 3px; cursor: pointer;">ğŸ¯ Tokyo</button>
                <button class="location-preset" data-lat="51.5074" data-lng="-0.1278" style="font-size: 10px; padding: 3px 5px; background: rgba(70, 130, 180, 0.2); border: 1px solid #4682b4; color: #4682b4; border-radius: 3px; cursor: pointer;">ğŸ° London</button>
                <button class="location-preset" data-lat="48.8566" data-lng="2.3522" style="font-size: 10px; padding: 3px 5px; background: rgba(138, 43, 226, 0.2); border: 1px solid #8a2be2; color: #8a2be2; border-radius: 3px; cursor: pointer;">ğŸ—¼ Paris</button>
                <button class="location-preset" data-lat="-33.8688" data-lng="151.2093" style="font-size: 10px; padding: 3px 5px; background: rgba(0, 191, 255, 0.2); border: 1px solid #00bfff; color: #00bfff; border-radius: 3px; cursor: pointer;">ğŸ–ï¸ Sydney</button>
                <button class="location-preset" data-lat="55.7558" data-lng="37.6173" style="font-size: 10px; padding: 3px 5px; background: rgba(220, 20, 60, 0.2); border: 1px solid #dc143c; color: #dc143c; border-radius: 3px; cursor: pointer;">ğŸ›ï¸ Moscow</button>
                <button class="location-preset" data-lat="39.9042" data-lng="116.4074" style="font-size: 10px; padding: 3px 5px; background: rgba(255, 140, 0, 0.2); border: 1px solid #ff8c00; color: #ff8c00; border-radius: 3px; cursor: pointer;">ğŸ® Beijing</button>
                <button class="location-preset" data-lat="28.6139" data-lng="77.2090" style="font-size: 10px; padding: 3px 5px; background: rgba(255, 165, 0, 0.2); border: 1px solid #ffa500; color: #ffa500; border-radius: 3px; cursor: pointer;">ğŸ•Œ Delhi</button>
              </div>
            </div>
            
            <button id="showImpactMap" style="font-size: 11px; padding: 6px 12px; background: rgba(255, 204, 0, 0.2); border: 1px solid #ffcc00; color: #ffcc00; border-radius: 3px; width: 100%;">ğŸ—ºï¸ View Impact Map</button>
          </div>
        </div>

        <!-- Asteroid Visibility Control -->
        <div id="sizeControls" style="margin-top: 12px; flex-direction: column; align-items: stretch;">
          <label for="sizeRatio">Asteroid Visibility</label> 
          <div class="slider-row">
            <input type="range" id="sizeRatio" min="1" max="25" step="1" value="1" />
            <span id="sizeRatioValue">1x</span>
          </div>
        </div>

        <!-- Enhanced Deflection Strategy Panel -->
        <div id="simulationControls">
          <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; border: 1px solid #444;">
            <div class="dropdown-header" onclick="toggleDropdown('defenseContent')" style="cursor: pointer; background: rgba(255, 204, 0, 0.1); border: 1px solid #ffcc00; border-radius: 6px; padding: 8px; display: flex; align-items: center; justify-content: space-between; margin: -12px -12px 12px -12px;">
              <h3 style="margin: 0; color: #ffcc00; font-size: 14px;">ğŸ›¡ï¸ Planetary Defense Mission</h3>
              <span id="defenseArrow" style="color: #ffcc00; font-weight: bold; transform: rotate(-90deg); transition: transform 0.3s;">â–¼</span>
            </div>
            
            <div id="defenseContent" style="display: none;">
              <!-- Auto Optimize Toggle -->
              <div style="margin: 6px 0 12px 0; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                <label style="display:flex; align-items:center; gap:8px; color:#ccc;">
                  <input type="checkbox" id="autoOptimize" checked style="margin-right: 4px;" />
                  Auto-Optimize (recommended)
                </label>
                <span style="font-size:10px; color:#888;">Toggle off to manually adjust parameters</span>
              </div>
              
              <!-- Mission Method Selection -->
              <div style="margin-bottom: 12px;">
                <label for="mitigationMethod" style="color: #ccc; font-weight: bold;">Deflection Method:</label>
                <select id="mitigationMethod" style="width: 100%; padding: 6px; margin-top: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 4px; color: #fff;">
                  <option value="kinetic">ğŸ¯ Kinetic Impactor (DART-style)</option>
                  <option value="gravity">ğŸŒŒ Gravity Tractor</option>
                  <option value="nuclear">ğŸ’¥ Nuclear Deflection</option>
                  <option value="laser">âš¡ Laser Ablation</option>
                  <option value="ion">ğŸ”‹ Ion Beam Shepherd</option>
                  <option value="mass_driver">ğŸš€ Mass Driver</option>
                </select>
              </div>

              <!-- Mission Timeline -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                <div>
                  <label for="yearsOut" style="color: #ccc; font-size: 12px;">Years to Impact:</label>
                  <input type="number" id="yearsOut" min="0.5" max="50" step="0.5" value="5" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
                </div>
                <div>
                  <label for="missionDuration" style="color: #ccc; font-size: 12px;">Mission Duration (years):</label>
                  <input type="number" id="missionDuration" min="0.1" max="10" step="0.1" value="1.0" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" />
                </div>
              </div>

              <!-- Delta-V Control -->
              <div style="margin-bottom: 12px;">
                <label for="deltaV" style="color: #ccc; font-weight: bold;">Î”V Applied:</label>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                  <input type="range" id="deltaV" min="0" max="500" step="0.1" value="0" style="flex: 1;" />
                  <span id="deltaVValue" style="color: #ffcc00; font-weight: bold; min-width: 80px;">0.0 mm/s</span>
                </div>
                <div style="font-size: 11px; color: #888; margin-top: 2px;">
                  Typical range: 0.1-100 mm/s (depends on method and timing)
                </div>
              </div>

              <!-- Spacecraft Mass Parameters -->
              <div style="margin-bottom: 12px;">
                <div>
                  <label for="spacecraftMass" style="color: #ccc; font-size: 12px;">Spacecraft Mass (kg):</label>
                  <input type="number" id="spacecraftMass" min="500" max="50000" step="50" value="" placeholder="Auto-Optimized" style="width: 100%; padding: 4px; background: rgba(255,255,255,0.1); border: 1px solid #555; border-radius: 3px; color: #fff;" title="Leave empty for method-optimal mass" />
                </div>
              </div>
              
              <div style="font-size: 10px; color: #888; margin-bottom: 12px; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 3px;">
                ğŸ’¡ Auto-optimization adjusts parameters based on asteroid characteristics<br>
                Method defaults: Kinetic(850kg), Gravity(2000kg), Nuclear(5000kg), Others(1400-4500kg)
              </div>

              <!-- Mission Results Display -->
              <div id="deflectionResults" style="background: rgba(0,0,0,0.4); padding: 12px; border-radius: 6px; border-left: 4px solid #ffcc00; margin-bottom: 8px;">
                <div style="color: #ffcc00; font-weight: bold; margin-bottom: 8px; font-size: 13px;">ğŸ“Š Mission Analysis</div>
                <div id="mitigationResult" style="color: #44ff88; font-weight: bold; margin-bottom: 6px; font-size: 12px;">
                  Miss Distance: Select parameters above
                </div>
                <div id="mitigationEfficiency" style="font-size: 11px; color: #aaa; margin-bottom: 6px;">
                  Method details will appear here
                </div>
                <div id="missionFeasibility" style="font-size: 11px; color: #ccc; margin-bottom: 6px;">
                  Mission feasibility: Not calculated
                </div>
              </div>

              <!-- Advanced Physics Display -->
              <div id="physicsDetails" style="padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; border: 1px solid #333; margin-bottom: 8px;">
                <div style="font-size: 11px; color: #aaa; margin-bottom: 6px;">ï¿½ Physics Analysis</div>
                <div id="orbitalMechanics" style="font-size: 10px; color: #bbb; line-height: 1.4;">
                  â€¢ Orbital velocity change: 0 m/s<br>
                  â€¢ Deflection angle: 0.000Â°<br>
                  â€¢ Energy efficiency: 0%<br>
                  â€¢ Success probability: 0%
                </div>
              </div>
            </div>
          </div>
          
          <!-- Enhanced Information Panel -->
          <div id="infoPanel" style="margin-top: 12px;">
            <div style="margin-bottom: 8px;">
              <button id="educationalMode" style="padding: 4px 8px; font-size: 12px;">ğŸ“š Educational Mode</button>
              <button id="gamificationMode" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">ğŸ® Defend Earth</button>
              <button id="scenarioMode" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">ğŸ­ Scenarios</button>
            </div>
            Select an asteroid (click name) to populate report. Open browser console to see fetched data.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- External JS -->
  <script type="module" src="impact-map.js"></script>
  <script type="module" src="scenarios.js"></script>
  <script type="module" src="main.js"></script>

  <!-- Asteroid search bar logic is now handled in main.js after asteroidCache is defined. -->
</body>
</html>
